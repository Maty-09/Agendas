<!DOCTYPE html>
<!-- prueba -->
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Agendar Mantención</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="max-w-xl mx-auto mt-10 bg-white p-8 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold text-center mb-6">Agendar Mantención</h1>

    {% if success %}
    <div class="bg-green-100 text-green-800 p-4 rounded-md mb-4 border border-green-300">
      ✅ Tu mantención fue agendada con éxito.
    </div>
    {% endif %}

    <!-- PASO 1: Elegir fecha-->
    {% if not fecha_seleccionada %}
    <form method="get" action="/cliente/agendar_web" class="space-y-4 mb-6">
      <input type="hidden" name="tipo" value="{{ tipo_servicio }}" />
      <input type="hidden" name="duracion_horas" value="{{ duracion_horas}}">
      <label class="block font-medium">Selecciona una fecha:</label>
      <input type="date" name="fecha" required min="{{ current_date }}" required class="w-full border px-3 py-2 rounded"  min="{{ current_date}}" />
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">
        Buscar horarios
      </button>
    </form>
    {% endif %}

    <!-- PASO 2: Elegir hora -->
    {% if fecha_seleccionada and duracion_horas is not none and horas_disponibles and not hora_confirmada %}
    <div class="mb-4 bg-green-100 text-green-800 p-4 rounded-md border border-green-300">
      <p class="font-semibold">✅ Mantención configurada:</p>
      <p>Duración: <strong>{{ duracion_horas }} hora{{ 's' if duracion_horas > 1 else '' }}</strong></p>
      <p>Fecha: <strong>{{ fecha_seleccionada }}</strong></p>
    </div>
    <form method="get" action="/cliente/agendar_web" class="space-y-4 mt-4">
      <input type="hidden" name="tipo" value="{{ tipo_servicio }}" />
      <input type="hidden" name="fecha" value="{{ fecha_seleccionada }}" />
      <input type="hidden" name="duracion_horas" value="{{ duracion_horas }}" />
      <label class="block font-medium">Selecciona una hora:</label>
      <select name="hora" required class="w-full border px-3 py-2 rounded">
        {% for hora in horas_disponibles %}
        <option value="{{ hora }}">{{ hora }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">
        Continuar
      </button>
    </form>
    {% elif fecha_seleccionada and not horas_disponibles and not hora_confirmada %}
    <p class="text-red-600 mt-4">No hay bloques disponibles para esta fecha.</p>
    {% endif %}

    <!-- PASO 3: Formulario datos cliente -->
    {% if fecha_seleccionada and hora_confirmada %}
    <div class="mb-4 bg-green-100 text-green-800 p-4 rounded-md border border-green-300">
      <p class="font-semibold">Detalle de tu mantención:</p>
      <ul class="list-disc ml-6">
        <li><strong>Fecha:</strong> {{ fecha_seleccionada }}</li>
        <li><strong>Hora:</strong> {{ hora_confirmada }}</li>
        <li><strong>Duración:</strong> {{ duracion_horas }} hora{{ 's' if duracion_horas > 1 else '' }}</li>
        <li><strong>Servicio:</strong> {{ "Equipo Especializado" if tipo_servicio == "especializado" else "Domicilio / Taller" }}</li>
      </ul>
    </div>
    <form method="post" action="/cliente/agendar_web" class="space-y-4 mt-4">
      <input type="hidden" name="tipo_servicio" value="{{ tipo_servicio }}" />
      <input type="hidden" name="fecha" value="{{ fecha_seleccionada }}" />
      <input type="hidden" name="hora" value="{{ hora_confirmada }}" />
      <input type="hidden" name="duracion_horas" value="{{ duracion_horas }}" />

      <label class="block font-medium">Nombre:</label>
      <input type="text" name="nombre" required class="w-full border px-3 py-2 rounded" />

      <label class="block font-medium">Apellido:</label>
      <input type="text" name="apellido" required class="w-full border px-3 py-2 rounded" />

      <label class="block font-medium">Correo electrónico:</label>
      <input type="email" name="correo" required class="w-full border px-3 py-2 rounded" />

      <label class="block font-medium">Teléfono:</label>
      <input type="text" name="telefono" required class="w-full border px-3 py-2 rounded" />

      <label class="block font-medium">Patente del vehículo:</label>
      <input type="text" name="patente" required class="w-full border px-3 py-2 rounded" />

      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">
        Agendar mantención
      </button>
    </form>
    {% endif %}
  </div>
</body>
</html>
